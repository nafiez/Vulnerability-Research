**Fuzzing 7-Zip For phun!**
---------------------------

Vulnerable package (7-Zip 15.05): https://sourceforge.net/projects/sevenzip/files/7-Zip/15.05/7z1505.exe/download

Parameter: 7z.exe e -y example_file_here

Fuzzer: https://github.com/googleprojectzero/Jackalope

Instrumentation: Jackalope uses TinyInst for instrumentation

Corpus: https://github.com/strongcourage/fuzzing-corpus
  
Page Heap: Enable page heap to for target process to monitor heap allocation and detects an attempt to access beyond memory allocation. gflags.exe /i 7z.exe +hpa

Here's one of the example target:
Potential candidate, a loop that does an comparison where var_14 is user controlled
```
.text:004012F0           loc_4012F0:                             ; CODE XREF: sub_4012B2+83â†“j
.text:004012F0 8B 45 EC                                mov     eax, [ebp+var_14]
.text:004012F3 33 F6                                   xor     esi, esi
.text:004012F5 8B 10                                   mov     edx, [eax]
.text:004012F7 80 3A 00                                cmp     byte ptr [edx], 0
.text:004012FA 74 07                                   jz      short loc_401303
```

Since 7z.exe is not protected with DEP and ASLR, here's he math to fuzz based on the offset:
```
  004012F0 - 00400000 = 0012f0
```
 
Jackalope fuzzer command as in following example:
```
fuzzer.exe -in in -out out -t 2000+ -delivery file -instrument_module 7z.exe -target_module 7z.exe -target_offset 0x0012f0 -nargs 2 -iterations 50000 -persist -loop -cmp_coverage -- "C:\Program Files (x86)\7-Zip\7z.exe" e -y @@
```
    
Attaching 7z.exe with debugger along with its parameter:
![image](https://user-images.githubusercontent.com/789149/157390281-98b7ac33-49a0-4749-af74-8a4367ea68de.png)

When open the crash test case generated by Jackalope using WinDBG, you should be able to observe an access violation:
![image](https://user-images.githubusercontent.com/789149/157390575-91735972-e90d-4773-b644-f31966b04823.png)

![image](https://user-images.githubusercontent.com/789149/157391154-3e59cf33-54eb-454f-923e-91490612a750.png)


